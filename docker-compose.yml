version: "3.8"

services:
  filebrowser:
    image: filebrowser/filebrowser:latest
    command: ["--noauth", "--database", "/database/filebrowser.db"]
    volumes:
      - filebrowser_data:/srv
      - filebrowser_database:/database
      - filebrowser_config:/config
    networks:
      dokploy-network:
        aliases:
          - filebrowser-nonauth   # ✅ 고유 alias

  fb-proxy:
    image: nginx:alpine
    depends_on:
      - filebrowser
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - dokploy-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.files.rule=Host(`file.sonub.com`)"
      - "traefik.http.routers.files.entrypoints=websecure"
      - "traefik.http.routers.files.tls=true"
      - "traefik.http.services.files.loadbalancer.server.port=80"

volumes:
  filebrowser_data:
  filebrowser_database:
  filebrowser_config:

networks:
  dokploy-network:
    external: true
