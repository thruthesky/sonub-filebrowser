version: "3.8"

services:
  # 1) FileBrowser: 무인증 공개 업로드
  filebrowser:
    image: filebrowser/filebrowser:latest
    command: ["--noauth", "--database", "/database/filebrowser.db"]
    volumes:
      - filebrowser_data:/srv
      - filebrowser_database:/database
      - filebrowser_config:/config
    networks:
      - dokploy-network
    # ⚠️ 외부로 직접 노출하지 마세요. (ports 없음)

  # 2) Nginx 프록시: 외부 요청 받되 DELETE는 막음
  fb-proxy:
    image: nginx:alpine
    depends_on:
      - filebrowser
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - dokploy-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.files.rule=Host(`file.sonub.com`)"
      - "traefik.http.routers.files.entrypoints=websecure"
      - "traefik.http.routers.files.tls=true"
      - "traefik.http.services.files.loadbalancer.server.port=80"

volumes:
  filebrowser_data:
  filebrowser_database:
  filebrowser_config:

networks:
  dokploy-network:
    external: true
